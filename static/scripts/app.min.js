!function(){"use strict";var e="goal-grid-login-prototype",r="AIzaSyA8izaYTPKoj0roPVeBH1verzc8aoHGcx0",t="669303885284",o={apiKey:r,authDomain:e+".firebaseapp.com",databaseURL:"https://"+e+".firebaseio.com",projectId:e,storageBucket:e+".appspot.com",messagingSenderId:t};firebase.initializeApp(o);var a=angular.module("goalgrid",["ngResource","ngCookies","angularjs-dropdown-multiselect","mp.autoFocus","ui.bootstrap","colorpicker.module","angular-packery","angular-sortable-view","angularSpectrumColorpicker","ngTable","ngFileUpload","ngOrderObjectBy","firebase","ui.router"]);a.run(["$transitions","$state",function(e,r){var t=function(e){"AUTH_REQUIRED"===e.error().detail&&(console.log("AUTH_REQUIRED. Redirecting to login."),r.go("login"))};e.onError({},t)}]),a.config(["$stateProvider","$urlRouterProvider",function(e,r){r.otherwise("home"),e.state("login",{url:"/login",controller:"FirebaseuiController",templateUrl:"static/views/login.html"}).state("home",{url:"/home",controller:"MainCtrl",templateUrl:"static/views/main.html",resolve:{currentAuth:["FirebaseuiFactory","userFactory","accountFactory",function(e,r,t){var o=e.isLoggedIn();return o.then(function(){var o=e.getUser();return t.getCurrentUserData(o).then(function(){return r.currentUser.id=o.uid,o.displayName?r.currentUser.name=o.displayName:r.currentUser.name=o.email,r.currentUser.role=t.currentUserData.role,o})})}]}}).state("404",{url:"/404",templateUrl:"static/views/404.html"})}]),angular.module("goalgrid").config(["$httpProvider",function(e){e.defaults.withCredentials=!0,e.defaults.xsrfCookieName="_xsrf",e.defaults.xsrfHeaderName="X-CSRFToken"}])}();
!function(){"use strict";angular.module("goalgrid").controller("AccountCtrl",["$scope","accountFactory","userFactory",function(e,t,c){e.accountsModal={},e.accountsModal.newAccountsLoading={},e.accountsModal.newGroup={selectedManagersArray:[],selectedMembersArray:[]},e.accountsModal.justManagers=t.justManagers,e.newAccount={},e.currentEdit={},e.accountsModal.currentGroupEdit={},e.accountsModal.groupDropdownSettings={displayProp:"name",enableSearch:!1,smartButtonMaxItems:5,externalIdProp:""},e.accountsModal.dropdownTexts={buttonDefaultText:"Select",dynamicButtonTextSuffix:"selected",checkAll:"Select All",uncheckAll:"Deselect All"},e.accountsModal.accountDropdownSettings={displayProp:"username",enableSearch:!0,smartButtonMaxItems:5,externalIdProp:""},e.accountsModal.getGroupMemberCount=t.getGroupMemberCount,e.accountsModal.getGroupManagerCount=t.getGroupManagerCount,e.resetNewAccount=function(){e.newAccount={selectedMemberOfArray:[],selectedManagerOfArray:[]}},e.resetAccountModal=function(){e.resetNewAccount(),e.accountsModal.newGroup={selectedManagersArray:[],selectedMembersArray:[]},e.currentEdit={},e.currentGroupEdit={}},e.accountsModal.addGroup=function(){t.addGroup(e.accountsModal.newGroup),e.accountsModal.newGroup={selectedManagersArray:[],selectedMembersArray:[]}},e.accountsModal.toggleDeleteGroupMode=function(t){e.accountsModal.currentGroupEdit[t].deleteMode=!e.accountsModal.currentGroupEdit[t].deleteMode},e.accountsModal.editGroup=function(c){e.accountsModal.currentGroupEdit[c.id]={};var o=[],n=[];angular.forEach(c.members,function(e,c){t.accounts[c]&&o.push(t.accounts[c])}),angular.forEach(c.managers,function(e,c){t.accounts[c]&&n.push(t.accounts[c])}),c.selectedMembersArray=o,c.selectedManagersArray=n,e.accountsModal.currentGroupEdit[c.id].group=c,e.accountsModal.currentGroupEdit[c.id].deleteMode=!1,e.accountsModal.currentGroupEdit[c.id].stopDelete=!1},e.accountsModal.saveGroup=function(c){t.updateGroup(e.accountsModal.currentGroupEdit[c.id].group).then(function(){}),e.accountsModal.currentGroupEdit[c.id]={}},e.accountsModal.deleteGroup=function(c){t.deleteGroup(c),e.accountsModal.currentGroupEdit[c]={}},e.addAccount=function(){e.accountsModal.newAccountsLoading[e.newAccount.username]={username:e.newAccount.username},t.addAccount(e.newAccount).then(function(t){delete e.accountsModal.newAccountsLoading[t.username]}),e.resetNewAccount()},e.toggleDeleteAccountMode=function(t){0===t||c.currentUser.id===t?e.currentEdit[t].stopDelete=!0:e.currentEdit[t].deleteMode=!e.currentEdit[t].deleteMode},e.editAccount=function(c){e.currentEdit[c.id]={};var o=[],n=[];c.groups&&c.groups.memberOf&&angular.forEach(c.groups.memberOf,function(e,c){o.push(t.allGroups[c])}),c.groups&&c.groups.managerOf&&angular.forEach(c.groups.managerOf,function(e,c){n.push(t.allGroups[c])}),c.selectedMemberOfArray=o,c.selectedManagerOfArray=n,e.currentEdit[c.id].account=c,e.currentEdit[c.id].deleteMode=!1,e.currentEdit[c.id].stopDelete=!1},e.saveAccount=function(c){t.updateAccount(e.currentEdit[c.id].account).then(function(){}),e.currentEdit[c.id]={}},e.deleteAccount=function(c){t.deleteAccount(c),e.currentEdit[c]={}},e.resetAccountModal()}])}();
!function(){"use strict";angular.module("goalgrid").controller("FirebaseuiController",["FirebaseuiFactory",function(e){this.signInSuccess=function(e){return!0};var i="#/home",n={callbacks:{signInSuccess:this.signInSuccess,uiShown:function(){document.getElementById("loader").style.display="none"}},signInFlow:"redirect",signInSuccessUrl:i,signInOptions:[{provider:firebase.auth.EmailAuthProvider.PROVIDER_ID,requireDisplayName:!0}]};e.ui.start("#firebaseui-auth-container",n)}])}();
!function(){"use strict";angular.module("goalgrid").controller("GoalCtrl",["$scope","goalFactory","viewFactory","modalData",function(l,o,e,a){l.goalModal={},l.goalModal={},l.goalModal.getGoalColor=o.getGoalColor,l.goalModal.categoryColors=o.hardCodedGoalCategoryColors,l.days=["Sun","Mon","Tues","Wed","Thurs","Fri","Sat"],l.selectedDays=[],l.toggleSelectedDays=function(l,o,e){if(o){var a=o.indexOf(l);a>-1?o.splice(a,1):o.push(l)}else e.selectedDays=[l]},l.goalModal.colorPaletteOptions={allowEmpty:!0,showPaletteOnly:!0,showInput:!0,togglePaletteOnly:!0,preferredFormat:"name",palette:o.colorPaletteChoices,replacerClassName:"form-control"},l.goalModal.linkColorChoices=o.colorPaletteChoices,l.goalModal.allGoalTypes=o.allGoalTypes,l.goalModal.modalGoalType=o.currentGoalModalType,l.goalModal.linkedGoalsDropdownSettings={displayProp:"goalText",groupByTextProvider:function(l){var e=o.allGoalTypes[l];return e?e.name:""},enableSearch:!0},l.goalModal.linkedGoalsDropdownTexts={buttonDefaultText:"Select linked goals",dynamicButtonTextSuffix:"linked",checkAll:"Select All",uncheckAll:"Deselect All"},l.goalModal.modalState=a,a.editOnly?l.goalModal.modalGoals=[o.visibleGoalsFlatObject[a.goal.id]]:o.currentUserGoals?l.goalModal.modalGoals=o.currentUserGoals[l.goalModal.modalGoalType.id]:l.goalModal.modalGoals={},l.goalModal.modalGoalLinkOptions=o.filterOutOneTypeOfGoal(l.goalModal.modalGoalType.id),l.newGoal=o.newGoal,l.currentEdit=o.currentEdit,l.resetGoalsModal=function(){o.resetGoalModal(l.goalModal.modalGoalType.id),l.currentEdit=o.currentEdit,l.selectedDays=["Sun","Mon","Tues","Wed","Thurs","Fri","Sat"]},l.addGoal=function(){if(l.newGoal.singleGoalCompletion&&delete l.newGoal.recur,l.newGoal.singleGoalCompletion===!1&&l.newGoal.recur){"weeks"===l.newGoal.recur.repeatType&&1==l.newGoal.recur.frequencyCount&&(l.newGoal.recur.selectedDays=l.selectedDays);var t=o.getEndOrStartOfGoalsPeriodUsingDate(l.newGoal,a.currentViewDate,"start");l.newGoal.recur.startDate=t}l.newGoal.goalTypeID=l.goalModal.modalGoalType.id;var d=angular.copy(l.newGoal);o.addGoal(d,a.currentViewDate).then(function(){e.addGoalToAllViews(d),l.goalModal.modalState.addOnly&&(l.resetGoalsModal(),l.$close())}),o.resetNewGoal(l.goalModal.modalGoalType.id)},l.editGoal=function(o){l.currentEdit[o.id]={},l.currentEdit[o.id].goal=angular.copy(o)},l.saveGoal=function(e){var a=l.currentEdit[e.id].goal;o.updateGoal(a).then(function(){l.goalModal.modalState.editOnly&&(l.resetGoalsModal(),l.$close())}),l.currentEdit[e.id]={}},l.toggleDeleteGoalMode=function(o){l.currentEdit[o].deleteMode=!l.currentEdit[o].deleteMode},l.goalModal.toggleGoalInactiveAfter=function(e){var a=moment().valueOf();o.toggleGoalInactiveAfter(e,a),e.inactiveAfterTimestamp&&(l.currentEdit[e.id]={},l.goalModal.modalState.editOnly&&(l.resetGoalsModal(),l.$close()))},l.deleteGoal=function(a,t){e.removeGoalFromAllViews(a,t),o.deleteGoal(a),l.currentEdit[a]={},l.goalModal.modalState.editOnly&&(l.resetGoalsModal(),l.$close())},angular.equals(o.currentEdit,{})&&l.resetGoalsModal(),l.goalModal.modalState.addOnly&&l.$watch("goalModal.modalGoalType.id",function(e){o.resetGoalModal(e),l.goalModal.modalGoalLinkOptions=o.filterOutOneTypeOfGoal(e)})}])}();
!function(){"use strict";angular.module("goalgrid").controller("MainCtrl",["$scope","$filter","$location","userFactory","goalFactory","accountFactory","pictureFactory","viewFactory","reportsFactory","$modal","noteFactory","FirebaseuiFactory",function(e,a,n,r,t,i,o,l,s,u,c,m){e.main={},e.main.logOut=function(){c.visibleNotesFlatObject.$destroy&&c.visibleNotesFlatObject.$destroy(),s.unreadNoteIDs.$destroy&&s.unreadNoteIDs.$destroy(),m.logout()},e.main.isInitialLoadDone=!1,e.main.getVisibleNotesForCurrentUserByCurrentView=function(){var a,n;return e.main.isViewDaily(e.main.currentView)?(a=e.main.currentViewDate,n="MM/dd/yyyy"):e.main.isViewMonthly(e.main.currentView)?(a=e.main.currentViewDate,n="MM/yyyy"):e.main.isViewYearly(e.main.currentView)?(a=e.main.currentViewDate,n="yyyy"):(a=void 0,n=void 0),c.getSingleUserNotes(e.main.currentUser.id,a,n,e.main.currentView.name)},e.main.addOrEditNoteModal=function(a,n){var t={editOnly:!1,addOnly:!0,noteView:l.currentView.name,allowPrivate:!0,user:{}};if(c.resetNoteModal(l.currentView.name),void 0!==n){t.editOnly=!0,t.addOnly=!1,t.note=c.visibleNotesFlatObject[n];var o=c.isManagerNote(t.note),s=c.isThisUsersNote(t.note),u=c.isCurrentUserManagerOfNote(t.note);if(!s&&!u||s&&o)return;c.currentEdit[n]={},c.currentEdit[n].note=angular.copy(t.note)}e.main.showReports?t.viewDate=new Date:t.viewDate=e.main.currentViewDate,void 0===a||a===r.currentUser.id?(t.user=angular.copy(r.currentUser),t.user.name||(t.user.name=t.user.username),t.managerID=null,t.managerName=null):(t.user=angular.copy(i.accounts[a]),t.user.name=t.user.username,t.managerID=r.currentUser.id,t.managerName=r.currentUser.name),c.openNoteModal(l.currentView.name,e,t)};var y=function(a,n,r,t){return u.open({animation:!0,templateUrl:n,controller:r,scope:e,size:t,resolve:{modalData:["$q",function(e){return e.when(a)}]}})};e.main.openHelpModal=function(){var e="static/views/modals/help_and_tips/help.html";return y({},e,"","lg")},e.main.gridViewClickEmptySpace=function(a,n){n&&t.resetGoalModal(n);var r={editOnly:!1,addOnly:!0};e.main.openGoalModal(n,r)},e.main.toggleChartViewRearrangeGoals=function(){e.main.linkViewDragEnabled=e.main.gridViewRearrangeGoals},e.main.gridViewClickGoal=function(a){var n=t.visibleGoalsFlatObject[a];t.resetGoalModal(n.goalTypeID),t.currentEdit[a]={},t.currentEdit[a].goal=angular.copy(n);var r={editOnly:!0,addOnly:!1,goal:n},i="static/views/modals/goals_inner.html";e.main.openGoalModal(n.goalTypeID,r,i)},e.main.openGoalModal=function(a,n,r){return void 0===n&&(e.main.setModalGoalType(a),n={editOnly:!1,addOnly:!1}),void 0===r&&(r="static/views/modals/goals_inner.html"),e.main.currentView.allowGoalLinkUI&&(n.allowGoalLinkUI=!0),n.currentViewDate=e.main.currentViewDate,y(n,r,"GoalCtrl")},e.main.openUnreadNotes=function(a){e.main.showReportsNoteSection=!0;var n={editOnly:!1,addOnly:!1},r="static/views/modals/unread_notes_mobile.html";return n.allowGoalLinkUI=!0,n.currentViewDate=e.main.currentViewDate,y(n,r,"ReportsCtrl")},e.main.getUnreadNotesForSingleUser=function(e){return c.getUnreadNotes(e)},e.main.getBackgroundColorStyleFromGoal=function(e,a){return{"background-color":t.getGoalColor(e)}},e.main.colorPercentageSquare=function(a,n,r){if(0===a){var i=t.getGoalColor(n);return"background-color: "+i+" !important;"}return t.colorPercentageSquare(a,n,r,e.main.currentViewDate,!1)},e.main.addPicToThisView=function(a,n,r){l.addPicToView(e.main.currentView.id,a,n,r),o.addViewIDToPicture(r,e.main.currentView.id)};var d=function(a){a?e.main.pictureForModal=angular.copy(o.allPictures[a]):(e.main.pictureForModal={src:"",viewIDs:{ignoreme:!0},selectionType:"file"},e.main.pictureForModal.viewIDs[e.main.currentView.id]=!0),e.main.pictureForModal.selectionType||(e.main.pictureForModal.selectionType="url")};e.main.setPictureAndOpenModal=function(a,n,r,t){var i={};i.currentView=e.main.currentView,i.viewLeft=n,i.viewFirstColumn=r,i.picListIndex=t,null===a&&(i.addOnly=!0),d(a),e.main.openPictureModal(i)},e.main.openPictureModal=function(a){var n="PictureCtrl",r="static/views/modals/pictures/pic_select.html";return void 0===a&&(a={currentView:e.main.currentView}),(e.main.currentView.allowPictureEdit||a.addOnly)&&(r="static/views/modals/pictures/pic_edit.html"),y(a,r,n)},e.main.toggleChartViewColorByLinkPath=function(){t.recolorGoals()},e.main.isObject1EqualToObject2=function(e,a){return angular.equals(e,a)},e.main.getObjectLength=function(e){if(!e)return 0;var a=e.length;return void 0!==a?a:(a=0,angular.forEach(e,function(e){a++}),a)},e.main.isViewDaily=function(e){var a=l.getViewSingleGoalTypeID(e);return null!==a&&t.isGoalDaily({goalTypeID:a})},e.main.isViewMonthly=function(e){var a=l.getViewSingleGoalTypeID(e);return null!==a&&t.isGoalMonthly({goalTypeID:a})},e.main.isViewYearly=function(e){var a=l.getViewSingleGoalTypeID(e);return null!==a&&t.isGoalYearly({goalTypeID:a})},e.main.isViewLifetime=function(e){var a=l.getViewSingleGoalTypeID(e);return null!==a&&t.isGoalLifeTime({goalTypeID:a})},e.main.incrementCurrentViewDateByViewAmount=function(a,n){var r="day";void 0!==n?r=n:e.main.isViewMonthly(e.main.currentView)?r="month":e.main.isViewYearly(e.main.currentView)&&(r="year"),e.main.currentViewDate=moment(e.main.currentViewDate).add(a,r).toDate()},e.main.isGoalDaily=function(e){return t.isGoalDaily(e)},e.main.isGoalMonthly=function(e){return t.isGoalMonthly(e)},e.main.isGoalYearly=function(e){return t.isGoalYearly(e)},e.main.isGoalLifeTime=function(e){return t.isGoalLifeTime(e)},e.main.isGoalYearlyOrLifeTime=function(e){return t.isGoalYearlyOrLifeTime(e)},e.main.isGoalCurrentlyComplete=function(a){return t.isGoalCompleteOnDate(a,e.main.currentViewDate)},e.main.validRecurDate=function(e,a){var n=moment(e.recur.startDate).recur();"weeks"!==e.recur.repeatType||1!=e.recur.frequencyCount?n=n.every(e.recur.frequencyCount,e.recur.repeatType):"weeks"===e.recur.repeatType&&1==e.recur.frequencyCount&&(n=n.every(e.recur.selectedDays).daysOfWeek());var r=t.getEndOrStartOfGoalsPeriodUsingDate(e,a,"start");return n.matches(r)},e.main.isGoalActiveInCurrentView=function(a){var n=e.main.currentViewDate,r=moment();moment(n).isSame(r,"day")&&(n=r.valueOf());var i=t.isGoalActiveOnDate(a,n);return i&&a.recur&&(i=e.main.validRecurDate(a,n)),i},e.main.getCurrentProgessDate=function(a){return t.getGoalProgressStringInRecurrenceOnDate(a,e.main.currentViewDate)},e.main.markGoalProgress=function(a,n,r){r.preventDefault(),r.stopPropagation(),t.markGoalProgressOnDate(a,n,e.main.currentViewDate)},e.main.getCurrentCompletionPercentageForGoal=function(a){return t.getGoalCompletionPercentageInRecurrenceOnDate(a,e.main.currentViewDate)},e.main.markGoalIncomplete=function(a,n){n.preventDefault(),n.stopPropagation(),t.markGoalProgressOnDate(a,"0",e.main.currentViewDate)},e.main.openGridDatePicker=function(a){a.preventDefault(),a.stopPropagation(),e.main.currentView.changeDate&&(e.main.gridDatePickerOpened=!0)},e.main.setModalGoalType=function(e){t.resetGoalModal(e)},e.main.enableView=function(a){e.main.currentViewDate=moment().startOf("day").toDate();var n=l.allViews[a],r=e.main.currentView;t.linkSettings.colorCodeByLinkPath&&(r.showColorByGroup||angular.equals(r,{}))&&(n.showColorByGroup||(t.linkSettings.colorCodeByLinkPath=!1,t.recolorGoals())),l.setCurrentView(a),e.main.currentView=l.currentView,e.main.isViewMonthly(e.main.currentView)?(e.main.currentDatePickerMode="month",e.main.currentDatePickerPopup="MMMM-yyyy"):e.main.isViewYearly(e.main.currentView)?(e.main.currentDatePickerMode="year",e.main.currentDatePickerPopup="yyyy"):(e.main.currentDatePickerMode="day",e.main.currentDatePickerPopup="EEE dd-MMMM-yyyy"),e.main.showReports=!1,e.main.showRewards=!1,e.main.showClaimReport=!1},e.main.changeOrderOfGoalsInCurrentView=function(e,a,n){l.reorderGoalsinCurrentView(e,a,n)},e.main.changeOrderOfPicturesInCurrentView=function(){l.savePicturesOrdersinView(e.main.currentView)},e.main.currentViewDate=moment().startOf("day").toDate(),e.main.currentDatePickerMode="day",e.main.currentDatePickerPopup="EEE dd-MMMM-yyyy",e.main.todayDate=moment().startOf("day").format(t.datePickerFormatString),e.main.pictureForModal={},e.main.linkViewDragEnabled=!0,e.main.dateOptions={startingDay:1,show_weeks:!1},e.main.currentUser=r.currentUser,e.main.showReportsNoteSection=!0,e.main.gridViewRearrangeGoals=!1,e.main.linkViewDragEnabled=e.main.gridViewRearrangeGoals,e.main.css="",e.main.bootstraps=[{name:"None",url:""},{name:"Cerulean",url:"cerulean"},{name:"Cosmo",url:"cosmo"},{name:"Cyborg",url:"cyborg"},{name:"Darkly",url:"darkly"},{name:"Flatly",url:"flatly"},{name:"Journal",url:"journal"},{name:"Lumen",url:"lumen"},{name:"Paper",url:"paper"},{name:"Readable",url:"readable"},{name:"Sandstone",url:"sandstone"},{name:"Simplex",url:"simplex"},{name:"Slate",url:"slate"},{name:"Spacelab",url:"spacelab"},{name:"Superhero",url:"superhero"},{name:"United",url:"united"},{name:"Yeti",url:"yeti"}],e.main.currentReportsTypeIDArray=s.currentReportsTypeIDArray,e.main.toggleGoalType=s.toggleGoalType,e.main.currentUserGoals=t.currentUserGoals,e.main.allPublicGoals=t.allPublicGoals,e.main.allVisibleGoalsFlatObject=t.visibleGoalsFlatObject,e.main.currentUserAllGoalsFlatArray=t.currentUserAllGoalsFlatArray,e.main.goalCompletionData=t.goalCompletionData,e.main.allGoalTypes=t.allGoalTypes,e.main.currentView={},e.main.allViews=l.allViews,e.main.allVisibleNotes=c.visibleNotesFlatObject,e.main.allPictures=o.allPictures,e.main.linkSettings=t.linkSettings,e.main.setCurrentUserBootstrapUrl=i.setCurrentUserBootstrapUrl;var p=function(){console.timeStamp("started_server_data_load - getAccountRoles"),i.getAccountRoles().then(function(){e.main.account_roles=i.account_roles,console.timeStamp("start_getAccounts"),i.getAccounts().then(function(){console.timeStamp("end_getAccounts"),e.main.css=i.currentUserData.bootstrapUrl,e.main.accounts=i.accounts,e.main.allGroups=i.allGroups,console.timeStamp("start_getNotes"),c.getNotes(e.main.currentUser.isManager()).then(function(){console.timeStamp("end_getNotes"),e.main.allVisibleNotes=c.visibleNotesFlatObject,e.main.unreadManagerNoteIDs=s.unreadNoteIDs}),console.timeStamp("start_getPics"),o.getPictures().then(function(a){console.timeStamp("end_getPics"),e.main.allPictures=o.allPictures}),console.timeStamp("start_getGoalTypes"),t.getGoalTypes().then(function(a){console.timeStamp("end_getGoalTypes"),console.timeStamp("start_getVisibleGoals"),t.getVisibleGoals(r.currentUser).then(function(a){console.timeStamp("end_getVisibleGoals"),console.timeStamp("start_getAllPublicGoals"),t.getAllPublicGoals().then(function(a){console.timeStamp("end_getAllPublicGoals"),e.main.allPublicGoals=t.allPublicGoals,e.main.allGoalTypes=t.allGoalTypes,e.main.currentUserGoals=t.currentUserGoals,e.main.allVisibleGoalsFlatObject=t.visibleGoalsFlatObject,e.main.currentUserAllGoalsFlatArray=t.currentUserAllGoalsFlatArray,e.main.unclaimedRewardIDs=t.unclaimedRewardIDs,e.main.linkSettings=t.linkSettings,console.timeStamp("start_getAllViews"),l.getAllViews().then(function(){console.timeStamp("end_getAllViews"),t.recolorGoals();var a=1;angular.forEach(l.allViews,function(e){void 0===e.goalArraysByType&&(e.goalArraysByType={}),void 0===e.goalIDsArraysByType&&(e.goalIDsArraysByType={}),angular.forEach(e.goalTypeIDs,function(a){void 0===e.goalIDsArraysByType[a]?e.goalArraysByType[a]=t.filterOnTypeOfGoal(a):(e.goalArraysByType[a]=[],angular.forEach(e.goalIDsArraysByType[a],function(n){e.goalArraysByType[a].push(t.visibleGoalsFlatObject[n])}))}),e.isInitial===!0&&(a=e.id)}),e.main.allViews=l.allViews,e.main.enableView(a),r.currentUser.isManager()?e.main.showReports=!0:e.main.showReports=!1,console.timeStamp("completed_server_data_function"),e.main.isInitialLoadDone=!0})})})})})})};p(),e.main.accounts=i.accounts,e.main.account_roles=i.account_roles,e.main.allGroups=i.allGroups}])}();
!function(){"use strict";angular.module("goalgrid").controller("NoteCtrl",["$scope","noteFactory","modalData","userFactory",function(e,t,o,n){e.noteModal={},e.noteModal.modalState=o,e.noteModal.newNote=t.newNote,e.noteModal.currentEdit=t.currentEdit,o.editOnly?e.noteModal.modalNotes=[t.visibleNotesFlatObject[o.note.id]]:e.noteModal.modalNotes=[],e.noteModal.returnSharedWithString=function(e){var a=n.currentUser.id===o.user.id,d=n.currentUser.id===o.managerID,l=(t.isManagerNote(e),t.isThisUsersNote(e)||a),r=t.isCurrentUserManagerOfNote(e)||d;return!l&&r?o.user.name:"my manager"},e.noteModal.resetNoteModal=function(){t.resetNoteModal(o.noteView)},e.noteModal.addNote=function(){var n=new Date;o.viewDate?(e.noteModal.newNote.timestamp=angular.copy(o.viewDate),e.noteModal.newNote.timestamp.setHours(n.getHours()),e.noteModal.newNote.timestamp.setMinutes(n.getMinutes()),e.noteModal.newNote.timestamp.setMilliseconds(n.getMilliseconds())):e.noteModal.newNote.timestamp=n,e.noteModal.newNote.timestamp=e.noteModal.newNote.timestamp.getTime(),e.noteModal.newNote.noteView=o.noteView,e.noteModal.newNote.managerID=o.managerID,e.noteModal.newNote.managerName=o.managerName,e.noteModal.newNote.userID=o.user.id,e.noteModal.newNote.private||(e.noteModal.newNote.private=!1);var a=angular.copy(e.noteModal.newNote);t.addNote(a).then(function(){o.addOnly&&(e.noteModal.resetNoteModal(),e.$close())}),t.resetNewNote(o.noteView)},e.noteModal.saveNote=function(n){var a=e.noteModal.currentEdit[n.id].note;t.updateNote(a).then(function(){o.editOnly&&(e.noteModal.resetNoteModal(),e.$close())}),e.noteModal.currentEdit[n.id]={}},e.noteModal.toggleDeleteNoteMode=function(t){e.noteModal.currentEdit[t].deleteMode=!e.noteModal.currentEdit[t].deleteMode},e.noteModal.deleteNote=function(o){t.deleteNote(o),e.noteModal.currentEdit[o]={},e.noteModal.modalState.editOnly&&(e.noteModal.resetNoteModal(),e.$close())}}])}();
!function(){"use strict";angular.module("goalgrid").controller("PictureCtrl",["$scope","pictureFactory","viewFactory","Upload","modalData",function(e,i,t,o,c){e.pictureModal={},e.pictureModal.modalData=c,e.pictureModal.resetPictureModal=function(){e.main.pictureForModal={selectionType:"file"},e.pictureModal.selectExisting=!1},e.pictureModal.convertFileToDataURL=function(i){i&&o.base64DataUrl(i).then(function(t){e.main.pictureForModal.src=t,e.main.pictureForModal.filename=i.name})},e.pictureModal.updatePictureSlot=function(){t.replacePicID(c.currentView.id,c.viewLeft,c.viewFirstColumn,c.picListIndex,e.pictureModal.selectedID),e.$close()},e.pictureModal.clearPictureSlot=function(){t.removePicFromView(c.currentView.id,c.viewLeft,c.viewFirstColumn,c.picListIndex),e.$close()},e.pictureModal.updateModalPicture=function(){e.main.pictureForModal.id?i.updatePicture(e.main.pictureForModal):i.addPicture(e.main.pictureForModal).then(function(i){e.main.addPicToThisView(c.viewLeft,c.viewFirstColumn,i),e.$close()})},e.pictureModal.deleteModalPicture=function(){t.removePictureFromAllViews(e.main.pictureForModal.id),i.deletePicture(e.main.pictureForModal.id).then(function(){e.$close()})}}])}();
!function(){"use strict";angular.module("goalgrid").controller("ReportsCtrl",["$scope","goalFactory","accountFactory","userFactory","reportsFactory","noteFactory","NgTableParams","$filter","$modal",function(r,e,t,o,n,a,s,i,p){r.reports={},r.reports.allVisibleNotes=a.visibleNotesFlatObject,r.reports.allAccounts=t.accounts,r.reports.showUser={},r.reports.showGroup={},r.reports.allGroups=t.allGroups,r.reports.currentReportFromDate=moment().startOf("month").toDate(),r.reports.currentReportToDate=moment().startOf("day").toDate(),r.reports.currentReportMaxFromDate=moment().startOf("day").format(e.datePickerFormatString),r.reports.startOfCurrentDate=moment().startOf("day").format(e.datePickerFormatString),r.reports.currentReportMinFromDate=moment(0).startOf("day").format(e.datePickerFormatString),r.reports.currentReportMinToDate=moment().startOf("month").format(e.datePickerFormatString),r.reports.currentReportsTypeIDArray=n.currentReportsTypeIDArray,r.reports.currentReportsPeriodText="days",r.reports.accountDropdownSettings={displayProp:"username",enableSearch:!0,smartButtonMaxItems:5,externalIdProp:""},r.reports.accountDropdownTexts={buttonDefaultText:"Select Users",dynamicButtonTextSuffix:"selected",checkAll:"Select All",uncheckAll:"Deselect All"},r.reports.numberOfMonthsCurrentlyInReportView=0,r.reports.reportMonthCounterArray=[0],r.reports.numberOfYearsCurrentlyInReportView=0,r.reports.reportYearCounterArray=[0],r.reports.goalReportShowDetails=!1,r.reports.notesToToggleStatus=[];var u={sorting:{goalTypeID:"asc"},count:100};r.reports.selectedReportsUserArray=[];var c=t.accounts[o.currentUser.id];o.currentUser.isManager()?angular.forEach(t.accounts,function(e){o.currentUser.id!==e.id&&r.reports.selectedReportsUserArray.push(e)}):c&&(r.reports.selectedReportsUserArray.push(c),r.reports.showUser[c.id]=!0,r.reports.showGroup.everyone=!0),r.reports.coachingReportSetAllNotes=function(){r.reports.coachingReportFilters.private="",r.reports.coachingReportFilters.managerID=""},r.reports.isThisNoteEditableByLoggedInUser=function(r){if(void 0!==r){var e=a.isManagerNote(r),t=a.isThisUsersNote(r),o=a.isCurrentUserManagerOfNote(r);return!(!t&&!o||t&&e)}},r.reports.isUserInUserArray=function(e){var t=_.findIndex(r.reports.selectedReportsUserArray,function(r){return r.id==e.id});return t!==-1};var l=function(t,o,n){var a=e.getStartOfMonthDateFromDateUsingMonthDiff(r.reports.currentReportFromDate,0).getTime(),s=e.getEndOfMonthDateFromDateUsingMonthDiff(r.reports.currentReportToDate,0).getTime(),i=t.timestamp>=a&&t.timestamp<=s;return i&&r.reports.isUserInUserArray({id:t.userID})};r.reports.coachingReportFilters={userID:r.reports.selectedReportsUserArray,managerID:"",private:""},r.reports.coachingTableParams=new s({sorting:{timestamp:"asc"},filter:r.reports.coachingReportFilters,count:1e5},{counts:[],filterDelay:0,getData:function(r,e){var o=i("orderObjectBy")(a.visibleNotesFlatObject,""),n={};angular.forEach(e.filter(),function(r,e){"userID"!==e&&(n[e]=r)});var s=e.filter()?i("filter")(o,n):o;s=i("filter")(s,l);var p=e.orderBy(),u=null;void 0!==e.sorting().userID&&(p=function(r){return t.accounts[r.userID].username},u="desc"===e.sorting().userID),void 0!==e.sorting().managerID&&(p=function(r){return r.managerID||0===r.managerID?t.accounts[r.managerID].username:""},u="desc"===e.sorting().managerID),void 0!==e.sorting().timestamp&&(p=function(r){return r.timestamp},u="desc"===e.sorting().timestamp);var c=e.sorting()?i("orderBy")(s,p,u):s;return r.resolve(c.slice((e.page()-1)*e.count(),e.page()*e.count())),r.promise}}),r.reports.getUsersFromGroup=function(r,e,o){var n={},a=t.allGroups[r];return e&&angular.forEach(a.managers,function(r,e){t.accounts[e]&&(n[e]=t.accounts[e])}),o&&("everyone"===r?angular.forEach(t.accounts,function(r){n[r.id]=r}):angular.forEach(a.members,function(r,e){t.accounts[e]&&(n[e]=t.accounts[e])})),n};var g=function(t,o){var n=e.getEndOfMonthDateFromDateUsingMonthDiff(r.reports.currentReportToDate),a=e.getGoalRewardObjectArray(n,r.reports.reportMonthCounterArray),s=i("filter")(a,r.filter),p=o.orderBy(),u=null;void 0!==o.sorting().claimReport&&(p=function(r){return 100==r.progress&&r.reward?r.claimDate?0:1:-1},u="desc"===o.sorting().claimReport),void 0!==o.sorting().progressDate&&(p=function(r){return moment(r.progressDateString)},u="desc"===o.sorting().progressDate);var c=o.sorting()?i("orderBy")(s,p,u):s;t.resolve(c.slice((o.page()-1)*o.count(),o.page()*o.count()))},m=function(t){return e.isGoalActiveOnDate(t,r.reports.currentReportToDate,"month")},d=function(t,o){var n=i("filter")(e.currentUserAllGoalsFlatArray,function(r){return 1!=r.goalTypeID&&!r.hideInRewards}),a=i("filter")(n,m),s=i("filter")(a,r.filter),p=o.orderBy(),u=null;void 0!==o.sorting().rewards&&(p=function(e){var t=r.reports.getRewardsForGoalOnCurrentReportWithIndex(e,0);if(!t)return"";var o=Object.keys(t)[0];if(!o)return"";var n=t[o];return n.rewardText},u="desc"===o.sorting().rewards),void 0!==o.sorting().progress&&(p=function(e){return parseInt(r.reports.getPercentageCompleteForCurrentReportWithIndex(e,0))},u="desc"===o.sorting().progress),void 0!==o.sorting().claimMain&&(p=function(e){if(100!=r.reports.getPercentageCompleteForCurrentReportWithIndex(e,0))return-1;if(!r.reports.getRewardsForGoalOnCurrentReportWithIndex(e,0))return-1;var t=r.reports.getRewardsForGoalOnCurrentReportWithIndex(e,0);if(!t)return 1;var o=Object.keys(t)[0];if(!o)return 1;var n=t[o],a=r.reports.getGoalRewardClaimedDateWithIndex(e,n,0);return a?0:1},u="desc"===o.sorting().claimMain);var c=o.sorting()?i("orderBy")(s,p,u):s;t.resolve(c.slice((o.page()-1)*o.count(),o.page()*o.count()))};r.reports.claimTableParams=new s(u,{counts:[],getData:g}),r.reports.rewardTableParams=new s(u,{counts:[],getData:d}),r.reports.getGoalRecurrenceStringWithIndex=function(t,o){var n=e.getEndOfMonthDateFromDateUsingMonthDiff(r.reports.currentReportToDate,o);return e.getGoalRecurrenceStringOnDate(t,n)},r.reports.getRecurrenceArrayForGoalBasedOnCurrentDateRange=function(t){return e.getRecurrenceArrayForGoalBasedOnStartDateAndMonthIndexArray(t,r.reports.currentReportToDate,r.reports.reportMonthCounterArray)},r.reports.toggleShowClaimReport=function(){r.reports.showClaimReport=!r.reports.showClaimReport,r.reports.showClaimReport?r.reports.setViewToLatestSixMonths():r.reports.setViewToCurrentMonth()},r.reports.addAdditionalRewardRow=function(t,o){void 0===o&&(o=0);var n=e.getEndOfMonthDateFromDateUsingMonthDiff(r.reports.currentReportToDate,o),a=!1,s=r.reports.getPercentageCompleteForCurrentReportWithIndex(t,0);"100"===s&&(a=!0),e.addRewardToGoalInRecurrenceOnDate(t,"",a,n)},r.reports.openRemoveRewardModal=function(t,o,n,a){void 0===a&&(a=0);e.getEndOfMonthDateFromDateUsingMonthDiff(r.reports.currentReportToDate,a);if(!o.managerID){if(""!==o.rewardText){var s={};return s.goal=t,s.reward=o,s.index=n,p.open({animation:!0,templateUrl:"static/views/modals/delete_reward.html",controller:["$scope","modalData",function(r,e){r.rewardModal={},r.rewardModal.modalData=e}],scope:r,resolve:{modalData:["$q",function(r){return r.when(s)}]}})}r.reports.removeReward(t,o,n,a)}},r.reports.removeReward=function(t,o,n,a){void 0===a&&(a=0);var s=e.getEndOfMonthDateFromDateUsingMonthDiff(r.reports.currentReportToDate,a);e.removeRewardFromGoalInRecurrenceOnDate(t,o,s)},r.reports.toggleGoalRewardClaimedWithIndex=function(t,o,n,a){var s=e.getEndOfMonthDateFromDateUsingMonthDiff(r.reports.currentReportToDate,n);e.toggleGoalRewardClaimedForDate(t,o,s,a)},r.reports.getGoalRewardClaimedDateWithIndex=function(t,o,n){var a=e.getEndOfMonthDateFromDateUsingMonthDiff(r.reports.currentReportToDate,n);return e.getGoalRewardClaimedDateInRecurrenceOnDate(t,o,a)},r.reports.isNoteUnread=function(r){return n.isNoteUnread(r)},r.reports.toggleNoteReadStatus=function(r){n.isNoteUnread(r)?n.markNoteRead(r):n.markNoteUnread(r)},r.reports.addNoteToToggleList=function(e,t){void 0===r.reports.notesToToggleStatus&&(r.reports.notesToToggleStatus=[]),r.reports.notesToToggleStatus.push([e,t.target.checked])},r.$on("modal.closing",function(){for(var e=0;e<r.reports.notesToToggleStatus.length;e++)r.reports.notesToToggleStatus[e][1]?n.markNoteRead(r.reports.notesToToggleStatus[e][0]):n.markNoteUnread(r.reports.notesToToggleStatus[e][0])}),r.reports.getCurrentReportNotesForUserByMonthIndex=function(t,o){var n=e.getDateFromDateUsingMonthDiff(r.reports.currentReportToDate,o);return a.getSingleUserNotes(t,n,"MM/yyyy")},r.reports.getUnreadNotesForSingleUser=function(r){return a.getUnreadNotes(r)},r.reports.shouldHighLightDate=function(t){if(r.reports.reportMonthCounterArray.length>1)return"";var o=moment(r.reports.startOfCurrentDate,e.datePickerFormatString);return o.isSame(r.reports.currentReportToDate)&&t===moment().date()?"highlight":""},r.reports.colorDailySquare=function(t,o,n,a){if(t<=0)return"";var s=e.getGoalColor(o),i=e.getDateFromDateUsingMonthDiff(r.reports.currentReportToDate,n);if(i.setDate(t),e.isGoalActiveOnDate(o,i)){var p=e.isGoalCompleteOnDate(o,i);if(o.singleGoalCompletion){var u=e.getGoalProgressStringInRecurrenceOnDate(o,i),c=moment(i).format("DD-MMM-YYYY");if(u===c&&p)return"White"==s&&(s="lightgrey"),"background-color: "+s+"!important;"}else if(p)return"White"==s&&(s="lightgrey"),"background-color: "+s+"!important;"}else if(!a)return"background-color: #888888!important;";return""},r.reports.colorPercentageSquare=function(t,o,n){return t<=0&&(t=-1),e.colorPercentageSquare(t,o,n,r.reports.currentReportToDate,!1)},r.reports.getRewardsGoalProgressStyles=function(e){var t={};return t.width=r.reports.getPercentageCompleteForCurrentReportWithIndex(e,0)+"%",t["background-color"]=e.color,t.border="1px solid "+e.color,t},r.reports.setViewToLatestSixMonths=function(){r.reports.currentReportFromDate=moment().startOf("month").startOf("day").toDate(),r.reports.currentReportToDate=moment().startOf("day").toDate();var e=moment(r.reports.currentReportFromDate).add(-5,"months");r.reports.currentReportFromDate=e.toDate(),r.reports.updateToFromAndMinMaxDates()},r.reports.setViewToCurrentMonth=function(){r.reports.currentReportFromDate=moment().startOf("month").startOf("day").toDate(),r.reports.currentReportToDate=moment().startOf("day").toDate(),r.reports.updateToFromAndMinMaxDates()},r.reports.setViewByMonthDiff=function(e){var t,o,n=moment(r.reports.currentReportFromDate),a=moment(r.reports.currentReportToDate),s=moment().subtract(1,"month").endOf("month").startOf("day");o=1===e&&a.isSame(s)?moment().startOf("day"):a.add(e,"months").endOf("month").startOf("day"),t=n.add(e,"months"),r.reports.currentReportFromDate=t.toDate(),r.reports.currentReportToDate=o.toDate(),r.reports.updateToFromAndMinMaxDates()},r.reports.openReportsDatePickers=function(e,t){e.preventDefault(),e.stopPropagation(),r.reports.reportsFromDatePickerOpened=t,r.reports.reportsToDatePickerOpened=!t},r.reports.monthPickerOptions={minMode:"month"},r.reports.getPercentageCompleteForCurrentReportWithIndex=function(t,o){var n;if("DD-MMM-YYYY"===e.allGoalTypes[t.goalTypeID].recurranceFormat){var a=r.reports.getGoalCompletionNumberForCurrentReportMonthsWithIndex(t,o),s=r.reports.getDaysForCurrentReportMonthsWithIndex(o);n=Math.round(a/s*100)+""}else{var i=e.getEndOfMonthDateFromDateUsingMonthDiff(r.reports.currentReportToDate,o);n=e.getGoalCompletionPercentageInRecurrenceOnDate(t,i)}return n},r.reports.getRewardsForGoalOnCurrentReportWithIndex=function(t,o){var n=e.getEndOfMonthDateFromDateUsingMonthDiff(r.reports.currentReportToDate,o);return e.getRewardsForGoalInRecurrenceOnDate(t,n)},r.reports.rewardTextChanged=function(t,o,n){var a=e.getEndOfMonthDateFromDateUsingMonthDiff(r.reports.currentReportToDate,n),s=e.getGoalRecurrenceStringOnDate(t,a),i=e.getRewardsRefUsingRecurrenceString(t,s);i.child(o.id).set(o)},r.reports.getDaysForCurrentReportMonthsWithIndex=function(t){return e.getReportDaysUsingDateWithMonthDiff(r.reports.currentReportToDate,t)},r.reports.getGoalCompletionNumberForCurrentReportMonthsWithIndex=function(t,o){var n=e.getStartOfMonthDateFromDateUsingMonthDiff(r.reports.currentReportToDate,o),a=e.getEndOfMonthDateFromDateUsingMonthDiff(r.reports.currentReportToDate,o);return e.getGoalCompletionsForDateRange(t,n,a)},r.reports.getMonthStringUsingCurrentToAndDiff=function(t){var o=e.getMomentFromDateUsingMonthDiff(r.reports.currentReportToDate,t);return o.format("MMM-YYYY")},r.reports.getDateStringWithGoalAndIndex=function(t,o){var n=e.getMomentFromDateUsingMonthDiff(r.reports.currentReportToDate,o),a=e.getGoalsTypeRecurrenceFormat(t);return n.format(a)},r.reports.getDateFromDateUsingMonthDiff=function(r,t){return e.getDateFromDateUsingMonthDiff(r,t)};var f=function(){r.reports.currentReportMaxFromDate=moment(r.reports.currentReportToDate).format(e.datePickerFormatString),r.reports.currentReportMinToDate=moment(r.reports.currentReportFromDate).format(e.datePickerFormatString)},D=function(){r.reports.numberOfMonthsCurrentlyInReportView=moment(r.reports.currentReportToDate).diff(r.reports.currentReportFromDate,"month"),r.reports.reportMonthCounterArray.splice(0);for(var e=r.reports.numberOfMonthsCurrentlyInReportView;e>=0;e--)r.reports.reportMonthCounterArray.push(e);for(r.reports.numberOfYearsCurrentlyInReportView=moment(r.reports.currentReportToDate).startOf("year").diff(moment(r.reports.currentReportFromDate).startOf("year"),"year"),r.reports.reportYearCounterArray.splice(0),e=0;e<=r.reports.numberOfYearsCurrentlyInReportView;e++)r.reports.reportYearCounterArray.push(e)},h=function(){moment(r.reports.currentReportToDate).format("MM-YYYY")===moment().format("MM-YYYY")?r.reports.currentReportToDate=moment().startOf("day").toDate():r.reports.currentReportToDate=moment(r.reports.currentReportToDate).endOf("month").startOf("day").toDate()};r.reports.updateToFromAndMinMaxDates=function(){h(),D(),f(),r.reports.rewardTableParams.reload(),r.reports.claimTableParams.reload(),r.reports.coachingTableParams.reload()},r.reports.toggleGoalReportDetails=function(){r.reports.goalReportShowDetails=!r.reports.goalReportShowDetails},r.reports.getCurrentReportGoals=function(r,t){return t===o.currentUser.id?e.currentUserGoals?void 0===e.currentUserGoals[r]?{}:e.currentUserGoals[r]:{}:void 0===e.allPublicGoals[t]?{}:void 0===e.allPublicGoals[t][r]?{}:e.allPublicGoals[t][r]}}])}();
!function(){"use strict";angular.module("goalgrid").controller("ViewCtrl",["$scope","viewFactory",function(o,r){}])}();
!function(){"use strict";angular.module("goalgrid").factory("accountFactory",["$resource","$q","$cookies","firebaseFactory","FirebaseuiFactory","$timeout",function(e,r,a,n,s,o){function u(e,r){var a=!1;t.accounts[e.id]=r,t.accounts[e.id].groups=e.groups,r.groups&&r.groups.memberOf?angular.forEach(r.groups.memberOf,function(e,r){t.currentUserData.groups&&t.currentUserData.groups.managerOf&&t.currentUserData.groups.managerOf[r]&&(a=!0)}):"manager"===t.currentUserData.role&&"user"===e.role&&(a=!0),a||"admin"===t.currentUserData.role||t.currentUserData.id==r.id?"manager"===e.role&&(t.justManagers[e.id]=r):delete t.accounts[e.id]}var t={},c=n.usersRef,l=n.groupsRef,i=n.firebaseRef.child("roles"),d=i.child("_options");t.accounts={},t.account_roles={},t.allGroups={},t.currentUserData={},t.justManagers={};var m=null,g=function(e){return l.child(e)},f=function(e){return c.child(e.id).child("userData")},p=function(e){return c.child(e.id)};t.getCurrentUserData=function(e){console.timeStamp("inside_getAccountRoles-start_getCurrentUserData"),m||t.setCurrentUserID(e.uid);var a=r.defer();return angular.equals({},t.currentUserData)?f({id:m}).once("value",function(e){if(e){var r=e.val();r&&(t.currentUserData=r,console.timeStamp("inside_getAccountRoles-end_getCurrentUserData"),a.resolve(t.currentUserData))}},function(e){console.log("Could not access current user data"),console.timeStamp("inside_getAccountRoles-end_getCurrentUserData-ERROR"),console.log(e)}):a.resolve(t.currentUserData),a.promise};var h=function(e){var a=r.defer(),o=function(r){var s={userData:{id:r.uid,name:e.username,role:e.role.name,roleID:e.role.id,email:e.email,bootstrapUrl:"cerulean"},viewData:{}};e.groups&&(s.userData.groups=e.groups),console.log("Getting default view node to create user"),n.firebaseRef.child("defaultViews").once("value",function(e){var n=e.val();s.viewData.views=n,console.log("Creating user metadata"),p({id:r.uid}).set(s),a.resolve(s.userData)})};return s.createUserAuth({displayname:e.username,email:e.email,password:e.pw,rolename:e.role.name},o,function(e,r,a){console.log("Create user call failed: "+a)}),a.promise};t.setCurrentUserID=function(e){m=e,n.setThisUserRef(e)},t.setCurrentUserBootstrapUrl=function(e){var r=f(t.currentUserData);return r.child("bootstrapUrl").set(e)},t.getAccountRoles=function(){var e=r.defer(),a=[];t.accounts={};var n=t.getCurrentUserData();if("admin"===t.currentUserData.role)d.once("value",function(r){if(r){t.account_roles={};var a=r.val();angular.forEach(a,function(e){e.id&&(t.account_roles[e.id]=e)}),e.resolve(t.account_roles)}}),a.push(e.promise);else{t.account_roles={};var s=t.currentUserData.role,o=t.currentUserData.roleID;t.account_roles[o]={id:o,name:s}}return a.push(n),r.all(a).then(function(){var e={id:t.currentUserData.id,username:t.currentUserData.name,email:t.currentUserData.email};e.role=t.account_roles[t.currentUserData.roleID],u(t.currentUserData,e)})},t.getAccounts=function(){var e=r.defer(),a=[];if(console.timeStamp("inside_getAccounts-start_serverAccounts"),"admin"!==t.currentUserData.role&&"manager"!==t.currentUserData.role||i.once("value",function(e){if(e){var r=e.val();angular.forEach(r,function(e,r){if("_options"!==r){var n={id:r},s=f(n).once("value",function(e){o(function(){if(e){var r=e.val();return!!r&&(n.username=r.name,n.role=t.account_roles[r.roleID],n.email=r.email,u(r,n),n)}})});a.push(s)}})}}),"admin"===t.currentUserData.role)l.once("value",function(r){var a=r.val();a&&(t.allGroups=r.val()),e.resolve(t.accounts)});else if("manager"===t.currentUserData.role){if(t.currentUserData.groups&&t.currentUserData.groups.managerOf){t.allGroups={};var n=t.currentUserData.groups.managerOf,s=[];angular.forEach(n,function(e,r){var a=g(r).once("value",function(e){var a=e.val();a&&(t.allGroups[r]=a)});s.push(a)}),r.all(s).then(function(){e.resolve(t.accounts)})}}else e.resolve(t.accounts);return e.promise};var v=function(e,r){var a=0;return t.allGroups[e]&&t.allGroups[e][r]&&angular.forEach(t.allGroups[e][r],function(e){e&&a++}),a},D=function(e){delete e.groups,e.selectedMemberOfArray.length&&(e.groups||(e.groups={}),e.groups.memberOf={},angular.forEach(e.selectedMemberOfArray,function(r){e.groups.memberOf[r.id]=!0})),e.selectedManagerOfArray.length&&(e.groups||(e.groups={}),e.groups.managerOf={},angular.forEach(e.selectedManagerOfArray,function(r){e.groups.managerOf[r.id]=!0}))},U=function(e){delete e.managers,delete e.members,e.selectedMembersArray&&e.selectedMembersArray.length&&(e.members={},angular.forEach(e.selectedMembersArray,function(r){e.members[r.id]=!0})),e.selectedManagersArray&&e.selectedManagersArray.length&&(e.managers={},angular.forEach(e.selectedManagersArray,function(r){e.managers[r.id]=!0}))},b=function(e){e.groups&&(angular.forEach(e.groups.memberOf,function(r,a){t.allGroups[a].members&&delete t.allGroups[a].members[e.id],g(a).child("members").child(e.id).set(null)}),angular.forEach(e.groups.managerOf,function(r,a){t.allGroups[a].managers&&delete t.allGroups[a].managers[e.id],g(a).child("managers").child(e.id).set(null)}))},O=function(e){var a=[];return angular.forEach(e.members,function(r,n){if(t.accounts[n]){t.accounts[n].groups&&t.accounts[n].groups.memberOf&&delete t.accounts[n].groups.memberOf[e.id];var s=f({id:n}).child("groups/memberOf").child(e.id).set(null);a.push(s)}}),angular.forEach(e.managers,function(r,n){if(t.accounts[n]){t.accounts[n].groups&&t.accounts[n].groups.managerOf&&delete t.accounts[n].groups.managerOf[e.id];var s=f({id:n}).child("groups/managerOf").child(e.id).set(null);a.push(s)}}),r.all(a)},G=function(e){e.groups&&(angular.forEach(e.groups.memberOf,function(r,a){t.allGroups[a].members||(t.allGroups[a].members={}),t.allGroups[a].members[e.id]=!0,g(a).child("members").child(e.id).set(!0)}),angular.forEach(e.groups.managerOf,function(r,a){t.allGroups[a].managers||(t.allGroups[a].managers={}),t.allGroups[a].managers[e.id]=!0,g(a).child("managers").child(e.id).set(!0)}))},A=function(e){var a=[];return angular.forEach(e.members,function(r,n){t.accounts[n].groups||(t.accounts[n].groups={}),t.accounts[n].groups.memberOf||(t.accounts[n].groups.memberOf={}),t.accounts[n].groups.memberOf[e.id]=!0;var s=f({id:n}).child("groups/memberOf").child(e.id).set(!0);a.push(s)}),angular.forEach(e.managers,function(r,n){t.accounts[n].groups||(t.accounts[n].groups={}),t.accounts[n].groups.managerOf||(t.accounts[n].groups.managerOf={}),t.accounts[n].groups.managerOf[e.id]=!0;var s=f({id:n}).child("groups/managerOf").child(e.id).set(!0);a.push(s)}),r.all(a)};t.getGroupMemberCount=function(e){return v(e,"members")},t.getGroupManagerCount=function(e){return v(e,"managers")};var M=function(e){g(e.id).child("id").set(e.id),g(e.id).child("name").set(e.name);var r=null;e.members&&(r=e.members),g(e.id).child("members").set(r);var a=null;e.managers&&(a=e.managers),g(e.id).child("managers").set(a)};return t.addGroup=function(e){return U(e),e.id=n.groupsRef.push().key,t.allGroups[e.id]=e,M(e),A(e),r.when(t.allGroups[e.id])},t.updateGroup=function(e){var a=r.defer();return O(e),U(e),A(e),M(e),t.allGroups[e.id]=e,a.resolve(t.allGroups[e.id]),a.promise},t.deleteGroup=function(e){O(t.allGroups[e]),g(e).set(null),delete t.allGroups[e]},t.addAccount=function(e){var a=r.defer();return D(e),h(e).then(function(r){e.id=r.id,G(e),t.accounts[r.id]=e,"manager"===e.role.name&&(t.justManagers[e.id]=e),a.resolve(t.accounts[r.id])}),a.promise},t.updateAccount=function(e){var a=r.defer(),n=function(r){b(e),"manager"!==e.role.name&&(e.selectedManagerOfArray=[]),D(e),delete t.justManagers[e.id],t.accounts[e.id]=e,"manager"===e.role.name&&(t.justManagers[e.id]=e);var n=f(e);n.child("name").set(e.username),n.child("role").set(e.role.name),n.child("roleID").set(e.role.id),n.child("email").set(e.email),e.groups?(n.child("groups").set(e.groups),G(e)):n.child("groups").set(null),console.log("User updated"),a.resolve(e)},o={id:e.id,displayname:e.username,email:e.email,password:e.pw,rolename:e.role.name};return e.pw&&""!==e.pw.trim()||delete o.password,s.updateUserAuth(o,n,function(e,r,a){console.log("Update user call failed: "+a)}),a.promise},t.deleteAccount=function(e){var a=r.defer(),n=function(r){b(t.accounts[e]),delete t.justManagers[e],delete t.accounts[e],p({id:e}).set(null),console.log("User deleted"),a.resolve(e)};return s.deleteUserAuth({id:e},n,function(e,r,a){console.log("Delete user call failed: "+a)}),a.promise},t}])}();
!function(){"use strict";angular.module("goalgrid").factory("firebaseFactory",["userFactory",function(e){var r=firebase.database().ref("/"),s={};return s.firebaseRef=r,s.usersRef=r.child("users"),s.groupsRef=r.child("groups"),s.setThisUserRef=function(e){s.thisUserRef=r.child("users").child(e)},s}])}();
!function(){"use strict";angular.module("goalgrid").factory("FirebaseuiFactory",["$firebaseAuth","$location","$window","$rootScope",function(e,t,n,r){var o={},a=firebase.app().options.projectId,u="https://us-central1-"+a+".cloudfunctions.net/api/",s=firebase.auth();return o.firebaseAuthObject=e(s),o.ui=new firebaseui.auth.AuthUI(s),o.dataRoot=firebase.database().ref(),o.userToken=null,o.isLoggedIn=function(){return o.firebaseAuthObject.$requireSignIn()},o.logout=function(){console.log("logout called"),s.signOut().then(function(){console.log("Log out successful. Redirecting"),r.$apply(function(){t.path("/login")})}).catch(function(e){console.log("Log out failed",e)})},o.createUserAuth=function(e,t,n){o.userToken?$.ajax({url:u+"newUser",type:"POST",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+o.userToken)},data:e,success:t,error:n}):console.error("Cannot create user, this account is not fully authenticated yet - please wait a moment and try again")},o.updateUserAuth=function(e,t,n){o.userToken?$.ajax({url:u+"updateUser",type:"POST",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+o.userToken)},data:e,success:t,error:n}):console.error("Cannot update user, this account is not fully authenticated yet - please wait a moment and try again")},o.deleteUserAuth=function(e,t,n){o.userToken?$.ajax({url:u+"deleteUser",type:"POST",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+o.userToken)},data:e,success:t,error:n}):console.error("Cannot delete user, this account is not fully authenticated yet - please wait a moment and try again")},o.getUser=function(){return s.currentUser&&s.currentUser.getIdToken(!0).then(function(e){o.userToken=e;var t=s.currentUser.uid;$.ajax({url:u+"roles?user="+t,type:"GET",beforeSend:function(t){t.setRequestHeader("Authorization","Bearer "+e)},success:function(e){console.log("Check admin call success")},error:function(e,t,n){console.log("Check admin call failed: "+n)}})}),s.currentUser},o}])}();
!function(){"use strict";angular.module("goalgrid").factory("goalFactory",["$q","$filter","$firebaseObject","accountFactory","firebaseFactory",function(e,a,t,r,o){var l={},n=o.firebaseRef.child("defaultGoalTypes"),i=o.thisUserRef.child("goalData"),c=i.child("goals");l.linkSettings={};var s=moment().startOf("day"),d=moment().startOf("month"),u=moment().startOf("year"),m=moment().startOf("year").subtract(1,"years"),f=({1:{range:0},2:{range:d.diff(s,"days")},3:{range:u.diff(s,"days")},4:{range:m.diff(s,"days")}},moment().startOf("day").toDate(),{1:{id:1,name:"Day",recurranceFormat:"DD-MMM-YYYY",defaultColor:"Lime",displayPercentage:!1},2:{id:2,name:"Month",recurranceFormat:"MMM-YYYY",defaultColor:"MistyRose",displayPercentage:!0},3:{id:3,name:"Year",recurranceFormat:"YYYY",defaultColor:"Cyan",displayPercentage:!0},4:{id:4,name:"Life",recurranceFormat:"none",defaultColor:"MediumSpringGreen",displayPercentage:!0}});l.hardCodedGoalCategoryColors={1:{id:1,category:"Physical / Health",color:"#CBB0F3"},2:{id:2,category:"Mind / Intellect",color:"#B0B1F4"},3:{id:3,category:"Work / Career",color:"#EBCCA5"},4:{id:4,category:"Financial",color:"#EFB0A9"},5:{id:5,category:"Social / Community",color:"#F4F3B0"},6:{id:6,category:"Family",color:"#B1F4AF"},7:{id:7,category:"Spiritual",color:"#B0F4F3"},8:{id:8,category:"Personal / Other",color:"#F1F2F3"}},l.colorPaletteChoices=[["White","Lime","MistyRose","Cyan","MediumSpringGreen"],["DarkOrange","DeepPink","Yellow","Chartreuse","CornFlowerBlue"],["SkyBlue","Aquamarine","Coral","CornSilk","Fuchsia"],["Gold","GreenYellow","HoneyDew","Khaki","LightSteelBlue"],["PaleTurquoise","Orange","Tomato","Wheat","Thistle"]];l.currentUserGoals={},l.visibleGoalsFlatObject={},l.allPublicGoals={},l.newGoal={},l.currentUserAllGoalsFlatArray=[],l.allGoalTypes=f,l.defaultNoLinkPathColor="lightgrey",l.newlinkPathColorIndex=10,l.datePickerFormatString="DD-MMMM-YYYY",l.currentEdit={},l.currentGoalModalType={},l.unclaimedRewardIDs=[],l.getGoalFirebaseRefFromGoal=function(e){return c.child(e.goalTypeID).child(e.id)},l.getGoalCompletionStructureRef=function(e,a){return l.getGoalFirebaseRefFromGoal(e).child("completed/dates/"+a)},l.getRewardsRefUsingRecurrenceString=function(e,a){return l.getGoalCompletionStructureRef(e,a).child("/rewards")},l.isGoalActiveOnDate=function(e,a,t){var r=!0,o=!0,l=moment(a);return void 0===t&&(t="millisecond"),e.inactiveBeforeTimestamp&&(r=l.isAfter(e.inactiveBeforeTimestamp,t),!r&&l.isSame(e.inactiveBeforeTimestamp,t)&&(r=!0)),e.inactiveAfterTimestamp&&(o=l.isBefore(e.inactiveAfterTimestamp,t),!o&&l.isSame(e.inactiveAfterTimestamp,t)&&(o=!0)),r&&o},l.getGoalRewardObjectArray=function(e,a){var t=[];return angular.forEach(l.currentUserAllGoalsFlatArray,function(r){if(1!==r.goalTypeID){var o=l.getRecurrenceArrayForGoalBasedOnStartDateAndMonthIndexArray(r,e,a);angular.forEach(o,function(a){var o=l.getDateFromDateUsingMonthDiff(e,a);angular.forEach(l.getRewardsForGoalInRecurrenceOnDate(r,o),function(e){var n={},i=l.getGoalCompletionPercentageInRecurrenceOnDate(r,o),c=l.getGoalProgressStringInRecurrenceOnDate(r,o),s=l.getGoalRewardClaimedDateInRecurrenceOnDate(r,e,o);n.goal=r,n.reward=e,n.progress=i,n.progressDateString=c,n.claimDate=s,n.monthIndex=a,t.push(n)})})}}),t},l.removeRewardIDFromUnclaimedList=function(e){var a=_.indexOf(l.unclaimedRewardIDs,e);a!==-1&&l.unclaimedRewardIDs.splice(a,1)},l.addRewardIDToUnclaimedList=function(e){l.unclaimedRewardIDs.push(e)},l.addRewardToGoalInRecurrenceOnDate=function(e,a,t,r){var o=l.getGoalRecurrenceStringOnDate(e,r);void 0===e.completed&&(e.completed={}),void 0===e.completed.dates&&(e.completed.dates={}),void 0===e.completed.dates[o]&&(e.completed.dates[o]={}),void 0===e.completed.dates[o].rewards&&(e.completed.dates[o].rewards={});var n=l.getRewardsRefUsingRecurrenceString(e,o).push(),i={id:n.key,rewardText:a};e.completed.dates[o].rewards[i.id]=i,n.set(i),t&&l.addRewardIDToUnclaimedList(i.id)},l.removeRewardFromGoalInRecurrenceOnDate=function(e,a,t){var r=l.getGoalRecurrenceStringOnDate(e,t);l.removeRewardIDFromUnclaimedList(a.id),void 0!==e.completed&&void 0!==e.completed.dates&&void 0!==e.completed.dates[r]&&void 0!==e.completed.dates[r].rewards&&(delete e.completed.dates[r].rewards[a.id],l.getRewardsRefUsingRecurrenceString(e,r).child(a.id).set(null))},l.colorPercentageSquare=function(e,a,t,r,o){var n=10*e;if(n<0)return"";var i=l.getEndOfMonthDateFromDateUsingMonthDiff(r,t),c=l.getGoalCompletionPercentageInRecurrenceOnDate(a,i);return n>parseInt(c)?"":"background-color: "+l.getGoalColor(a)+" !important;"},l.getGoalColor=function(e){if(e.category){e.coloredByLinkPath=!1;var a=l.hardCodedGoalCategoryColors[e.category.id].color;return a}var t=l.allGoalTypes[e.goalTypeID];return t.defaultColor},l.recolorGoals=function(){angular.forEach(l.currentUserAllGoalsFlatArray,function(e){var a=(e.color,l.getGoalColor(e));e.color=a})},l.resetNewGoal=function(e){var a=l.allGoalTypes[e];l.newGoal.goalTypeID=e,l.newGoal.completed={},l.newGoal.private=!1,l.newGoal.goalText="",l.newGoal.customColor=a.defaultColor,l.newGoal.singleGoalCompletion=!0,l.newGoal.hideInRewards=!0,a.recurByDefault?l.newGoal.singleGoalCompletion=!1:l.newGoal.singleGoalCompletion=!0,"Lifetime"!==a.name&&(l.newGoal.recur={},l.newGoal.recur.frequencyCount=1),"Activities"===a.name?l.newGoal.recur.repeatType="days":"Monthly"===a.name?l.newGoal.recur.repeatType="months":"Yearly"===a.name&&(l.newGoal.recur.repeatType="years"),a.autoHideIncompleteOneTimeGoalsByDefault?l.newGoal.autoHideIncompleteOneTimeGoals=!0:l.newGoal.autoHideIncompleteOneTimeGoals=!1,a.displayPercentage?l.newGoal.checkboxCompletion=!1:l.newGoal.checkboxCompletion=!0},l.resetGoalModal=function(e){l.currentGoalModalType=l.allGoalTypes[e],l.resetNewGoal(e),l.currentEdit={}},l.getGoalsTypeRecurrenceFormat=function(e){return l.allGoalTypes[e.goalTypeID].recurranceFormat},l.getReportDaysUsingDateWithMonthDiff=function(e,a){var t,r;if(0===a)return t=moment(e).startOf("day"),r=moment(l.getStartOfMonthDateFromDateUsingMonthDiff(e,a)),t.diff(r,"days")+1;var o=l.getMomentFromDateUsingMonthDiff(e,a);return o.add(1,"month"),new Date(o.year(),o.month(),0).getDate()},l.isGoalYearlyOrLifeTime=function(e){return l.isGoalLifeTime(e)||l.isGoalYearly(e)},l.isGoalDaily=function(e){return"DD-MMM-YYYY"===l.allGoalTypes[e.goalTypeID].recurranceFormat},l.isGoalMonthly=function(e){return"MMM-YYYY"===l.allGoalTypes[e.goalTypeID].recurranceFormat},l.isGoalYearly=function(e){return"YYYY"===l.allGoalTypes[e.goalTypeID].recurranceFormat},l.isGoalLifeTime=function(e){return"none"===l.allGoalTypes[e.goalTypeID].recurranceFormat},l.getDateFromDateUsingMonthDiff=function(e,a){return l.getMomentFromDateUsingMonthDiff(e,a).toDate()},l.getMomentFromDateUsingMonthDiff=function(e,a){var t=moment(angular.copy(e)).subtract(a,"months");return t},l.getStartOfMonthDateFromDateUsingMonthDiff=function(e,a){var t=moment(e).startOf("month").toDate();return l.getDateFromDateUsingMonthDiff(t,a)},l.getEndOfMonthDateFromDateUsingMonthDiff=function(e,a){var t=moment(e).endOf("month").startOf("day").toDate();return l.getDateFromDateUsingMonthDiff(t,a)},l.getGoalRecurrenceStringOnDate=function(e,a){var t,r=l.getGoalsTypeRecurrenceFormat(e);return t=e.singleGoalCompletion?"0":r&&"none"!==r?moment(a).format(r):"0"},l.getRecurrenceArrayForGoalBasedOnStartDateAndMonthIndexArray=function(e,a,t){var r=[],o={};return angular.forEach(t,function(t){var n=l.getEndOfMonthDateFromDateUsingMonthDiff(a,t),i=l.getGoalRecurrenceStringOnDate(e,n),c=l.isGoalActiveOnDate(e,n,"month"),s=c&&!o[i];e.singleGoalCompletion&&(s=c),s&&(o[i]=!0,r.push(t))}),r},l.isGoalCompleteOnDate=function(e,a){var t=l.getGoalRecurrenceStringOnDate(e,a);return void 0!==e.completed&&void 0!==e.completed.dates&&!(!e.completed.dates[t]||"100"!==e.completed.dates[t].percentage)},l.toggleGoalRewardClaimedForDate=function(e,a,t,r){var o=l.getGoalRecurrenceStringOnDate(e,t);if(e.completed.dates[o])if(e.completed.dates[o][a.id])delete e.completed.dates[o][a.id],r&&delete r.claimDate,l.unclaimedRewardIDs.push(a.id);else{var n=new Date;e.completed.dates[o][a.id]=n,r&&(r.claimDate=n),l.removeRewardIDFromUnclaimedList(a.id)}},l.getGoalRewardClaimedDateInRecurrenceOnDate=function(e,a,t){var r=l.getGoalRecurrenceStringOnDate(e,t);return void 0!==e.completed.dates[r]&&e.completed.dates[r][a.id]};var g=function(e,a,t){var r=null,o=moment(a),n=null;return l.isGoalDaily(e)?n="day":l.isGoalMonthly(e)?n="month":l.isGoalYearly(e)&&(n="year"),n&&(r="end"===t?o.endOf(n).valueOf():o.startOf(n).valueOf()),r};return l.getEndOrStartOfGoalsPeriodUsingDate=g,l.markGoalProgressOnDate=function(e,a,t){var r=l.getGoalRecurrenceStringOnDate(e,t),o=!1,n=!1,i=new Date;void 0===e.completed&&(e.completed={},e.completed.dates={}),void 0===e.completed.dates&&(e.completed.dates={}),e.completed.dates[r]?"100"===e.completed.dates[r].percentage?"100"!==a&&(n=!0):"100"===a&&(o=!0):(e.completed.dates[r]={},"100"===a&&(o=!0)),e.completed.dates[r].date=i,e.completed.dates[r].percentage=a,(o||n)&&angular.forEach(e.completed.dates[r].rewards,function(e){o&&l.unclaimedRewardIDs.push(e.id),n&&l.removeRewardIDFromUnclaimedList(e.id)});var c=l.getGoalCompletionStructureRef(e,r);c.child("date").set(i.getTime()),c.child("percentage").set(a),e.singleGoalCompletion&&("100"===a?e.inactiveAfterTimestamp=g(e,t,"end"):"0"===a&&(e.inactiveAfterTimestamp=null),l.getGoalFirebaseRefFromGoal(e).child("inactiveAfterTimestamp").set(e.inactiveAfterTimestamp))},l.getGoalCompletionPercentageInRecurrenceOnDate=function(e,a){var t=l.getGoalRecurrenceStringOnDate(e,a);return void 0===e.completed||void 0===e.completed.dates?"0":void 0===e.completed.dates[t]?"0":void 0===e.completed.dates[t].percentage?"0":e.completed.dates[t].percentage},l.getRewardsForGoalInRecurrenceOnDate=function(e,a){var t=l.getGoalRecurrenceStringOnDate(e,a);return void 0===e.completed||void 0===e.completed.dates?{}:void 0===e.completed.dates[t]?{}:e.completed.dates[t].rewards},l.getGoalProgressStringInRecurrenceOnDate=function(e,a){var t=l.getGoalRecurrenceStringOnDate(e,a);return void 0===e.completed||void 0===e.completed.dates?"":void 0===e.completed.dates[t]?"":moment(e.completed.dates[t].date).format("DD-MMM-YYYY")},l.getGoalCompletionsForDateRange=function(e,a,t){var r=0;return e.completed&&angular.forEach(e.completed.dates,function(e,o){if(e.percentage&&"100"===e.percentage){var l=moment(e.date),n=moment(a),i=moment(t);l.diff(n,"days")>=0&&l.diff(i,"days")<=0&&r++}}),r},l.getGoalTypes=function(){var a=e.defer();return i=o.thisUserRef.child("goalData"),c=i.child("goals"),i.once("value",function(e){var a=e.val();a&&a.linkSettings&&(l.linkSettings.colorCodeByLinkPath=a.linkSettings.colorCodeByLinkPath)}),n.once("value",function(e){l.allGoalTypes={};var t=1;angular.forEach(e.val(),function(e){e.id&&(l.allGoalTypes[e.id]=e,t=e.id)}),l.allGoalTypes[1]&&(t=1),l.currentGoalModalType=l.allGoalTypes[t],a.resolve(l.allGoalTypes)}),a.promise},l.currentUserGoals={},l.getAllPublicGoals=function(){var a=e.defer();if("admin"==r.currentUserData.role||"manager"==r.currentUserData.role){if(l.allPublicGoals={},r.currentUserData.groups&&r.currentUserData.groups.managerOf||"admin"==r.currentUserData.role){var t={};"admin"===r.currentUserData.role?angular.forEach(r.allGroups,function(e){t[e.id]=!0}):t=r.currentUserData.groups.managerOf,angular.forEach(t,function(e,a){var t=r.allGroups[a];t.members&&angular.forEach(t.members,function(e,a){l.allPublicGoals[a]={},o.usersRef.child(a).once("value",function(e){if(e){var a=e.val(),t={};a.goalData&&(t=a.goalData.goals),angular.forEach(t,function(e){angular.forEach(e,function(e){e.private||(void 0===l.allPublicGoals[a.userData.id]&&(l.allPublicGoals[a.userData.id]={}),void 0===l.allPublicGoals[a.userData.id][e.goalTypeID]&&(l.allPublicGoals[a.userData.id][e.goalTypeID]={}),l.allPublicGoals[a.userData.id][e.goalTypeID][e.id]=e)})})}})})})}o.usersRef.once("value",function(e){var t=e.val();angular.forEach(t,function(e){if(e.id){l.allPublicGoals[e.userData.id]={};var a={};e.goalData&&(a=e.goalData.goals),angular.forEach(a,function(a){angular.forEach(a,function(a){a.private||(void 0===l.allPublicGoals[e.userData.id][a.goalTypeID]&&(l.allPublicGoals[e.userData.id][a.goalTypeID]={}),l.allPublicGoals[e.userData.id][a.goalTypeID][a.id]=a)})})}}),a.resolve(l.allPublicGoals)})}else l.allPublicGoals={},a.resolve(l.allPublicGoals);return a.promise},l.getVisibleGoals=function(a){var t=e.defer();return a.managerOf||i.child("goals").once("value",function(e){var a=e.val();l.currentUserGoals={},a&&(l.currentUserGoals=a),angular.forEach(l.currentUserGoals,function(e,a){angular.forEach(e,function(e){l.currentUserAllGoalsFlatArray.push(e),l.visibleGoalsFlatObject[e.id]=e})})}),t.resolve(l.currentUserGoals),t.promise},l.filterOutOneTypeOfGoal=function(e){return a("filter")(l.currentUserAllGoalsFlatArray,{goalTypeID:"!"+e},!1)},l.filterOnTypeOfGoal=function(e){return a("filter")(l.currentUserAllGoalsFlatArray,{goalTypeID:e},!1)},l.addGoal=function(a,t){var r=e.defer();if(a.id=c.push().key,a.completed={},a.completed.dates={},a.color=l.getGoalColor(a),void 0===l.currentUserGoals[a.goalTypeID]&&(l.currentUserGoals[a.goalTypeID]={}),a.createdTimestamp=firebase.database.ServerValue.TIMESTAMP,a.singleGoalCompletion){a.inactiveBeforeTimestamp=g(a,t,"start");l.allGoalTypes[a.goalTypeID];a.autoHideIncompleteOneTimeGoals&&(a.inactiveAfterTimestamp=g(a,t,"end"))}else delete a.autoHideIncompleteOneTimeGoals;return l.currentUserGoals[a.goalTypeID][a.id]=a,l.visibleGoalsFlatObject[a.id]=a,l.currentUserAllGoalsFlatArray.push(a),l.getGoalFirebaseRefFromGoal(a).set(a),r.resolve(a),r.promise},l.updateGoal=function(a){var t=e.defer();l.currentUserGoals[a.goalTypeID][a.id];return a.color=l.getGoalColor(a),_.assign(l.currentUserGoals[a.goalTypeID][a.id],a),l.getGoalFirebaseRefFromGoal(a).set(a),t.resolve(a),t.promise},l.toggleGoalInactiveAfter=function(e,a){e.inactiveAfterTimestamp?e.inactiveAfterTimestamp=null:e.inactiveAfterTimestamp=a,l.getGoalFirebaseRefFromGoal(e).child("inactiveAfterTimestamp").set(e.inactiveAfterTimestamp)},l.findAllRewardIDsForGoal=function(e){var a=[];return e.completed&&e.completed.dates?(angular.forEach(e.completed.dates,function(e){angular.forEach(e.rewards,function(e){a.push(e.id)})}),a):a},l.deleteGoal=function(e){var a=l.visibleGoalsFlatObject[e];angular.forEach(l.findAllRewardIDsForGoal(a),function(e){l.removeRewardIDFromUnclaimedList(e)});var t=a.goalTypeID;delete l.currentUserGoals[t][e],delete l.visibleGoalsFlatObject[e],_.remove(l.currentUserAllGoalsFlatArray,{id:e}),l.getGoalFirebaseRefFromGoal({id:e,goalTypeID:t}).set(null)},l}])}();
!function(){"use strict";angular.module("goalgrid").factory("noteFactory",["$q","$filter","$modal","$firebaseObject","firebaseFactory","userFactory","reportsFactory",function(e,t,a,n,r,i,o){var s={},l=r.thisUserRef.child("noteData").child("notes");s.visibleNotesFlatObject={},s.newNote={},s.currentEdit={};var u=function(e){return r.usersRef.child(e.userID+"/noteData")},c=function(e){return u(e).child("/notes/"+e.id)},d=function(e){return u(e).child("unreadNoteIDs/"+e.id)},m=function(e){d(e).set(!0)},v=function(e){d(e).set(null)};({1:{id:1,userID:3,managerID:null,timestamp:moment().subtract(1,"day").hour(16).minute(15).toDate().getTime(),private:!1,noteView:"Day",noteText:"Didn't get any tours today"},2:{id:2,userID:3,managerID:2,timestamp:moment().subtract(1,"day").hour(17).minute(5).toDate().getTime(),private:!1,noteView:"Manager",noteText:"Helped Sally practice her intent statement"},3:{id:3,userID:3,managerID:2,timestamp:moment().subtract(1,"month").hour(12).toDate().getTime(),private:!1,noteView:"Manager",noteText:"Helped Sally review the sales script"},4:{id:4,userID:3,managerID:null,timestamp:moment().subtract(2,"day").hour(9).minute(0).toDate().getTime(),private:!1,noteView:"Day",noteText:"Attended sales training class"},5:{id:5,userID:3,managerID:null,timestamp:moment().hour(5).minute(10).toDate().getTime(),private:!0,noteView:"Day",noteText:"Went for bike ride with kids"},6:{id:6,userID:3,managerID:2,timestamp:moment().subtract(2,"day").hour(12).toDate().getTime(),private:!0,noteView:"Manager",noteText:"Private observation - I decided to give a VIP client to Veronica instead of Sally"}});s.isManagerNote=function(e){return null!==e.managerID&&void 0!==e.managerID},s.isThisUsersNote=function(e){return e.userID===i.currentUser.id},s.isCurrentUserManagerOfNote=function(e){return e.managerID===i.currentUser.id},s.openNoteModal=function(e,t,n,r){return void 0===n&&(s.resetNoteModal(e),n={editOnly:!1,addOnly:!0,noteView:e,user:{},managerID:null,viewDate:new Date}),void 0===r&&(r="static/views/modals/notes/note_layout.html"),a.open({animation:!0,templateUrl:r,controller:"NoteCtrl",scope:t,resolve:{modalData:["$q",function(e){return e.when(n)}]}})},s.resetNewNote=function(e){s.newNote.id=0,s.newNote.userID=0,s.newNote.managerID=null,s.newNote.managerName=null,s.newNote.timestamp=(new Date).getTime(),s.newNote.private=!1,s.newNote.noteView=e,s.newNote.noteText=""},s.resetNoteModal=function(e){s.resetNewNote(e),s.currentEdit={}},s.getSingleUserNotes=function(e,a,n,r){var i=[];return angular.forEach(s.visibleNotesFlatObject,function(o){if(o.userID===e){var s=!0,l=!0;if(void 0!==a){var u="MM/dd/yyyy";void 0!==n&&(u=n);var c=t("date")(o.timestamp,u),d=t("date")(a,u);s=c===d}void 0!==r&&(l=o.noteView===r),s&&l&&i.push(o)}}),t("orderBy")(i,"timestamp")},s.getUnreadNotes=function(e){var a=[];return angular.forEach(s.visibleNotesFlatObject,function(t){t.userID===e&&t.managerID&&o.isNoteUnread(t.id)&&a.push(t)}),t("orderBy")(a,"timestamp")};var f=function(){i.currentUser.isManager()||angular.forEach(s.visibleNotesFlatObject,function(e){s.isManagerNote(e)&&s.isThisUsersNote(e)&&e.private&&delete s.visibleNotesFlatObject[e.id]})};return s.getNotes=function(t){var a=e.defer();if(t){var i=n(r.usersRef);i.$loaded().then(function(){s.visibleNotesFlatObject={},angular.forEach(i,function(e){var a={};e.noteData&&(a=e.noteData.notes),angular.forEach(a,function(e){e.private&&t&&!e.managerID||e.private&&!t&&e.managerID?angular.noop():s.visibleNotesFlatObject[e.id]=e})}),a.resolve(s.visibleNotesFlatObject)})}else s.visibleNotesFlatObject=n(l),s.visibleNotesFlatObject.$watch(function(){f()}),s.visibleNotesFlatObject.$loaded().then(function(){f(),a.resolve(s.visibleNotesFlatObject)});return a.promise},s.addNote=function(t){var a=e.defer();return t.id=u(t).child("notes").push().key,t.createdTimestamp=firebase.database.ServerValue.TIMESTAMP,s.visibleNotesFlatObject[t.id]=t,c(t).set(t),t.managerID&&!t.private&&m(t),a.resolve(t),a.promise},s.updateNote=function(t){var a=e.defer(),n=s.visibleNotesFlatObject[t.id];return n.managerID&&!n.private&&v(t),_.assign(s.visibleNotesFlatObject[t.id],t),c(t).set(t),t.managerID&&!t.private&&m(t),a.resolve(s.visibleNotesFlatObject[t.id]),a.promise},s.deleteNote=function(t){var a=e.defer(),n=s.visibleNotesFlatObject[t],r=n.userID,i=n.managerID,o={id:t,userID:r};return i&&v(o),delete s.visibleNotesFlatObject[t],c(o).set(null),a.resolve({}),a.promise},s}])}();
!function(){"use strict";angular.module("goalgrid").factory("pictureFactory",["$q","$firebaseObject","firebaseFactory",function(e,r,i){var t={},l=i.thisUserRef.child("pictures");t.allPictures={};var u=function(e){return l.child(e.id)};return t.addViewIDToPicture=function(e,r){t.allPictures[e.id].viewIDs[r]=!0,u(e).child("viewIDs/"+r).set(!0)},t.removeViewIDFromPicture=function(e,r){delete t.allPictures[e.id].viewIDs[r],u(e).child("viewIDs/"+r).set(null)},t.getPictures=function(){var r=e.defer();return l.once("value",function(e){var i=e.val();i&&(t.allPictures=i),r.resolve(t.allPictures)}),r.promise},t.updatePicture=function(r){var i=e.defer();return"url"===r.selectionType&&delete r.filename,_.assign(t.allPictures[r.id],r),u(r).set(r),i.resolve(t.allPictures[r.id]),i.promise},t.addPicture=function(r){var i=e.defer();return r.id=l.push().key,t.allPictures[r.id]=r,u(r).set(r),i.resolve(t.allPictures[r.id]),i.promise},t.deletePicture=function(r){var i=e.defer(),l={id:r};return delete t.allPictures[r],u(l).set(null),i.resolve({}),i.promise},t}])}();
!function(){"use strict";angular.module("goalgrid").factory("reportsFactory",["$q","$firebaseObject","firebaseFactory",function(r,e,t){var n={},o=t.thisUserRef.child("noteData").child("unreadNoteIDs");return n.currentReportsTypeIDArray=[1,2,3,4],n.unreadNoteIDs=e(o),n.isNoteUnread=function(r){return!!n.unreadNoteIDs&&n.unreadNoteIDs[r]},n.markNoteRead=function(r){o.child(r).set(null)},n.markNoteUnread=function(r){o.child(r).set(!0)},n.toggleGoalType=function(r){var e=n.currentReportsTypeIDArray.indexOf(r);e>-1?n.currentReportsTypeIDArray.splice(e,1):(n.currentReportsTypeIDArray.push(r),n.currentReportsTypeIDArray.sort(function(r,e){return r-e}))},n}])}();
!function(){"use strict";angular.module("goalgrid").factory("userFactory",["$cookies",function(r){var e={};return e.currentUser={},e.currentUser.isManager=function(){return"admin"===e.currentUser.role||"manager"===e.currentUser.role},e.currentUser.isAdmin=function(){return"admin"===e.currentUser.role},e}])}();
!function(){"use strict";angular.module("goalgrid").factory("viewFactory",["$q","$firebaseObject","firebaseFactory",function(e,r,i){var s={},t=(i.firebaseRef.child("defaultViews"),i.thisUserRef.child("viewData/views"));s.allViews={};return s.currentView={},s.currentView.goalArraysByType={},s.getViewSingleGoalTypeID=function(e){if(e.goalTypeIDs){var r=0,i=0;if(void 0!==e.goalTypeIDs.length)r=e.goalTypeIDs.length,i=0;else{var s=Object.keys(e.goalTypeIDs);r=s.length,i=s[0]}return void 0!==r&&1===r&&void 0!==i&&void 0!==e.goalTypeIDs[i]?e.goalTypeIDs[i]:null}return null},s.setCurrentView=function(e){s.currentView=s.allViews[e]},s.replacePicID=function(e,r,i,t,c){if(void 0!==r&&void 0!==i){var l=s.allViews[e];if(!l.pictureIDs)return;if(r){if(!l.pictureIDs.left)return;if(i){if(!l.pictureIDs.left.first)return;t===-1?l.pictureIDs.left.first.push(c):l.pictureIDs.left.first[t]=c}else{if(!l.pictureIDs.left.second)return;t===-1?l.pictureIDs.left.second.push(c):l.pictureIDs.left.second[t]=c}}else{if(!l.pictureIDs.right)return;if(i){if(!l.pictureIDs.right.first)return;t===-1?l.pictureIDs.right.first.push(c):l.pictureIDs.right.first[t]=c}else{if(!l.pictureIDs.right.second)return;t===-1?l.pictureIDs.right.second.push(c):l.pictureIDs.right.second[t]=c}}s.savePicturesOrdersinView(l)}},s.removePicFromView=function(e,r,i,t){if(void 0!==r&&void 0!==i){var c=s.allViews[e];if(!c.pictureIDs)return;if(r){if(!c.pictureIDs.left)return;if(i){if(!c.pictureIDs.left.first)return;c.pictureIDs.left.first.splice(t,1)}else{if(!c.pictureIDs.left.second)return;c.pictureIDs.left.second.splice(t,1)}}else{if(!c.pictureIDs.right)return;if(i){if(!c.pictureIDs.right.first)return;c.pictureIDs.right.first.splice(t,1)}else{if(!c.pictureIDs.right.second)return;c.pictureIDs.right.second.splice(t,1)}}s.savePicturesOrdersinView(c)}},s.addPicToView=function(e,r,i,t){if(void 0!==r&&void 0!==i){var c=s.allViews[e];c.pictureIDs||(c.pictureIDs={}),r?(c.pictureIDs.left||(c.pictureIDs.left={}),i?(c.pictureIDs.left.first||(c.pictureIDs.left.first=[]),c.pictureIDs.left.first.push(t.id)):(c.pictureIDs.left.second||(c.pictureIDs.left.second=[]),c.pictureIDs.left.second.push(t.id))):(c.pictureIDs.right||(c.pictureIDs.right={}),i?(c.pictureIDs.right.first||(c.pictureIDs.right.first=[]),c.pictureIDs.right.first.push(t.id)):(c.pictureIDs.right.second||(c.pictureIDs.right.second=[]),c.pictureIDs.right.second.push(t.id))),s.savePicturesOrdersinView(c)}},s.removePictureFromAllViews=function(e){angular.forEach(s.allViews,function(r){var i,t,c,l;r.pictureIDs&&(r.pictureIDs.left&&(r.pictureIDs.left.first&&(i=r.pictureIDs.left.first.indexOf(e),i!==-1&&r.pictureIDs.left.first.splice(i,1)),r.pictureIDs.left.second&&(t=r.pictureIDs.left.second.indexOf(e),t!==-1&&r.pictureIDs.left.second.splice(t,1))),r.pictureIDs.right&&(r.pictureIDs.right.first&&(c=r.pictureIDs.right.first.indexOf(e),c!==-1&&r.pictureIDs.right.first.splice(c,1)),r.pictureIDs.right.second&&(l=r.pictureIDs.right.second.indexOf(e),l!==-1&&r.pictureIDs.right.second.splice(l,1))),s.savePicturesOrdersinView(r))})},s.addGoalToAllViews=function(e){var r=e.goalTypeID;angular.forEach(s.allViews,function(i){_.contains(i.goalTypeIDs,r)&&(void 0===i.goalArraysByType&&(i.goalArraysByType={}),void 0===i.goalIDsArraysByType&&(i.goalIDsArraysByType={}),void 0===i.goalArraysByType[r]&&(i.goalArraysByType[r]=[]),void 0===i.goalIDsArraysByType[r]&&(i.goalIDsArraysByType[r]=[]),i.goalArraysByType[r].push(e),i.goalIDsArraysByType[r].push(e.id),t.child(i.id+"/goalIDsArraysByType/"+r).set(i.goalIDsArraysByType[r]))})},s.removeGoalFromAllViews=function(e,r){angular.forEach(s.allViews,function(i){if(_.contains(i.goalTypeIDs,r)){var s=_.findIndex(i.goalArraysByType[r],function(r){return r.id==e});s!==-1&&i.goalArraysByType[r].splice(s,1);var c=_.findIndex(i.goalIDsArraysByType[r],function(r){return r==e});c!==-1&&(i.goalIDsArraysByType[r].splice(c,1),t.child(i.id+"/goalIDsArraysByType/"+r).set(i.goalIDsArraysByType[r]))}})},s.getAllViews=function(){var r=e.defer();return t.once("value",function(e){s.allViews={},angular.forEach(e.val(),function(e){e.id&&(s.allViews[e.id]=e)}),r.resolve(s.allViews)}),r.promise},s.updateView=function(r){var i=e.defer();return s.allViews[r.id].url=r.url,i.resolve(s.allViews[r.id]),i.promise},s.reorderGoalsinCurrentView=function(e,r,i){var c=s.currentView,l=e.goalTypeID;c.goalIDsArraysByType[l].splice(r,1),c.goalIDsArraysByType[l].splice(i,0,e.id),t.child(c.id+"/goalIDsArraysByType/"+l).set(c.goalIDsArraysByType[l])},s.savePicturesOrdersinView=function(e){e.pictureIDs&&t.child(e.id+"/pictureIDs").set(e.pictureIDs)},s}])}();